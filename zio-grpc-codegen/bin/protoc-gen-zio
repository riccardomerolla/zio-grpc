#!/bin/bash
# Wrapper script for protoc-gen-zio plugin
# This script is called by protoc with --plugin=protoc-gen-zio=<path>

set -e

# Find the JAR file
SCRIPT_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"
CODEGEN_DIR="$(dirname "$SCRIPT_DIR")"

# Auto-detect Scala version directory
JAR_FILE=$(find "$CODEGEN_DIR/target" -name "protoc-gen-zio.jar" -type f 2>/dev/null | head -1)

if [ -z "$JAR_FILE" ] || [ ! -f "$JAR_FILE" ]; then
    echo "Error: Could not find protoc-gen-zio.jar in $CODEGEN_DIR/target/. Run 'sbt assembly' first." >&2
    exit 1
fi

# Run the plugin main class
exec java -jar "$JAR_FILE" "$@"
